<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Nation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <style>
        :root {
            --sg-red: #ef233c;
            --sg-red-700: #b91c1c;
        }

        .sg-card {
            background: #fff;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #fee2e2;
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.08);
        }

        .caption a {
            color: #1d4ed8;
            text-decoration: underline;
        }

        html {
            scroll-behavior: smooth;
        }

        /* Grids */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: white;
            padding: 1.25rem;
            border-radius: 0.75rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--sg-red);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--sg-red);
        }

        .stat-label {
            color: #4b5563;
            font-weight: 500;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem;
            margin: 1.5rem 0;
        }

        .feature-card {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.75rem;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        @media (max-width: 768px) {

            .stat-grid,
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-900 font-sans">

    <!-- Navigation (streamlined like index.html) -->
    <nav id="nav" class="bg-[var(--sg-red)] text-white p-4 shadow-md"></nav>

    <!-- Header -->
    <header class="bg-[var(--sg-red)] text-white p-6 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl font-extrabold tracking-tight" id="site-title">Loading...</h1>
            <p class="mt-2 text-lg opacity-95" id="site-subtitle"></p>
        </div>
    </header>

    <!-- Main -->
    <main class="max-w-6xl mx-auto p-6" id="content"></main>

    <!-- Footer -->
    <footer class="bg-gray-100 text-center p-6 text-sm text-gray-600" id="footer"></footer>

    <script>
        /* Chart helper (same spirit as index) */
        function renderChart(canvas, chart, sectionId, sectionTitle) {
            const labels = chart.labels || [];
            const ds = Array.isArray(chart.datasets) && chart.datasets.length
                ? chart.datasets.map((d, i) => ({
                    type: d.type || (sectionId === "payments" ? "bar" : "line"),
                    label: d.label || `Series ${i + 1}`,
                    data: d.data || [],
                    yAxisID: d.yAxis || "y",
                    borderColor: d.borderColor || "#ef233c",
                    backgroundColor: d.backgroundColor || (d.type === "bar" ? "rgba(239,35,60,0.35)" : "rgba(239,35,60,0.25)"),
                    fill: d.type !== "bar",
                    tension: d.type !== "bar" ? 0.35 : 0,
                    pointRadius: d.type !== "bar" ? 3 : 0
                }))
                : [{
                    type: sectionId === "payments" ? "bar" : "line",
                    label: chart.label || sectionTitle,
                    data: chart.data || [],
                    yAxisID: "y",
                    backgroundColor: "rgba(239,35,60,0.35)",
                    borderColor: "#ef233c",
                    fill: sectionId !== "payments",
                    tension: sectionId !== "payments" ? 0.35 : 0,
                    pointRadius: sectionId !== "payments" ? 3 : 0
                }];

            const hasRightAxis = ds.some(d => (d.yAxisID || d.y) === "y1");
            const yUnit = chart.yUnit || "";
            const y1Unit = chart.y1Unit || "";

            const fmt = (val, unit) => {
                if (unit === "%") return `${val}%`;
                if (unit === "M") return `${val}M`;
                if (unit === "S$B") return `S$${val}B`;
                return val;
            };

            new Chart(canvas, {
                data: { labels, datasets: ds },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const axis = ctx.dataset.yAxisID === "y1" ? y1Unit : yUnit;
                                    return `${ctx.dataset.label}: ${fmt(ctx.parsed.y, axis)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: (v) => fmt(v, yUnit) },
                            grid: { drawOnChartArea: true }
                        },
                        ...(hasRightAxis ? {
                            y1: {
                                beginAtZero: true,
                                position: 'right',
                                ticks: { callback: (v) => fmt(v, y1Unit) },
                                grid: { drawOnChartArea: false }
                            }
                        } : {})
                    }
                }
            });
        }

        function renderImageFigure(img) {
            if (img && img.src) {
                return `
          <figure class="mt-4">
            <img src="${img.src}" alt="${img.alt || ''}" class="w-full max-h-[500px] object-contain rounded-xl" loading="lazy" />
            <figcaption class="caption">
              ${img.caption || ""}
              ${img.source ? ` <span class="text-xs text-gray-500 italic">Source:
              <a href="${img.source.url}" target="_blank" rel="noopener">${img.source.text}</a></span>` : ""}
            </figcaption>
          </figure>`;
            }
            return `
        <figure class="mt-4">
          <div class="w-full h-56 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500">
            Image coming soon
          </div>
        </figure>`;
        }

        fetch("smartnation.json", { cache: "no-cache" })
            .then(r => r.json())
            .then(data => {
                /* --- NAV (unified) --- */
                const nav = document.getElementById("nav");
                nav.innerHTML = `
          <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="font-bold text-xl">${data.nav.title}</h1>
            <ul class="flex gap-6">
              ${data.nav.links.map(l => `
                <li><a href="${l.url}" class="${l.active ? 'underline' : 'hover:underline'}">${l.name}</a></li>
              `).join("")}
            </ul>
          </div>`;

                /* --- HEADER / FOOTER --- */
                document.getElementById("site-title").textContent = data.site.title;
                document.getElementById("site-subtitle").textContent = data.site.subtitle;
                document.getElementById("footer").textContent = data.site.footer;

                /* --- CONTENT --- */
                const main = document.getElementById("content");

                // Optional top timeline (from data.timeline if present)
                if (data.timeline && data.timeline.title && data.timeline.events) {
                    const tl = document.createElement("section");
                    tl.className = "sg-card";
                    tl.innerHTML = `
            <h2 class="text-2xl font-bold text-[var(--sg-red)] mb-6 text-center">${data.timeline.title}</h2>
            <div class="relative">
              <div class="absolute left-0 right-0 top-6 h-1 bg-red-100"></div>
              <div class="relative z-10 flex flex-wrap justify-between gap-4">
                ${data.timeline.events.map(e => `
                  <a href="#${e.id}" class="flex flex-col items-center text-center">
                    <div class="w-6 h-6 rounded-full bg-[var(--sg-red)] border-4 border-white shadow-[0_0_0_2px_#ef233c] mb-2"></div>
                    <div class="text-[var(--sg-red)] font-semibold">${e.year}</div>
                    <div class="text-sm max-w-[140px]">${e.title}</div>
                  </a>`).join('')}
              </div>
            </div>
            ${data.timeline.sources ? `
              <p class="text-xs text-gray-600 mt-3">Sources:
                ${data.timeline.sources.map(s => `<a href="${s.url}" target="_blank" rel="noopener" class="underline">${s.text}</a>`).join(" • ")}
              </p>` : ''}
          `;
                    main.appendChild(tl);
                }

                // Sections from JSON
                for (const [id, section] of Object.entries(data.sections || {})) {
                    let html = `<section class="sg-card" id="${id}">
            <h2 class="text-2xl font-bold text-[var(--sg-red)] mb-3">${section.title}</h2>`;

                    (section.paragraphs || []).forEach(p => { html += `<p class="mt-3">${p}</p>`; });
                    if (section.image) html += renderImageFigure(section.image);

                    if (section.milestones) {
                        html += `<ul class="list-disc ml-6 mt-3">
                ${section.milestones.map(m => `<li>${m}</li>`).join("")}
              </ul>`;
                    }

                    if (section.stats) {
                        html += `<div class="stat-grid mt-4">
                ${section.stats.map(s => `
                  <div class="stat-card">
                    <div class="stat-value">${s.value}</div>
                    <div class="stat-label">${s.label}</div>
                  </div>`).join("")}
              </div>`;
                    }

                    if (section.features) {
                        html += `<div class="feature-grid mt-4">
                ${section.features.map(f => `
                  <div class="feature-card">
                    <h3 class="font-bold text-blue-700 mb-2">${f.title}</h3>
                    <ul class="list-disc list-inside text-gray-700">
                      ${f.items.map(i => `<li>${i}</li>`).join("")}
                    </ul>
                  </div>`).join("")}
              </div>`;
                    }

                    if (section.chart) {
                        const chartId = id + "Chart";
                        html += `<canvas id="${chartId}" height="110" class="mt-6" aria-label="${section.title} chart"></canvas>`;
                    }

                    if (section.impact) {
                        html += `<div class="sg-card mt-4 bg-red-50">
                <h3 class="text-xl font-semibold text-red-700 mb-2">${section.impact.title}</h3>
                <p>${section.impact.text || ''}</p>
                ${section.impact.achievements ? `
                  <ul class="list-disc ml-6 mt-2">${section.impact.achievements.map(a => `<li>${a}</li>`).join("")}</ul>` : ''}
                ${section.impact.source ? `
                  <p class="text-xs text-gray-600 italic mt-2">
                    Source: <a class="underline" href="${section.impact.source.url}" target="_blank" rel="noopener">${section.impact.source.text}</a>
                  </p>` : ''}
              </div>`;
                    }

                    if (section.recognition) {
                        html += `<div class="sg-card mt-4 bg-blue-50">
                <h3 class="text-xl font-semibold text-blue-700 mb-2">${section.recognition.title}</h3>
                <p>${section.recognition.text || ''}</p>
                ${section.recognition.source ? `
                  <p class="text-xs text-gray-600 italic mt-2">
                    Source: <a class="underline" href="${section.recognition.source.url}" target="_blank" rel="noopener">${section.recognition.source.text}</a>
                  </p>` : ''}
              </div>`;
                    }

                    if (section.sources) {
                        html += `<p class="text-xs text-gray-600 mt-3">
                Sources: ${section.sources.map(s => `<a href="${s.url}" target="_blank" rel="noopener" class="underline">${s.text}</a>`).join(" • ")}
              </p>`;
                    }

                    html += `</section>`;
                    main.insertAdjacentHTML("beforeend", html);

                    // Render chart (if present)
                    if (section.chart) {
                        const canvas = document.getElementById(id + "Chart");
                        renderChart(canvas, section.chart, id, section.title);
                    }
                }
            })
            .catch(err => console.error('Error loading smartnation.json:', err));
    </script>
</body>

</html>